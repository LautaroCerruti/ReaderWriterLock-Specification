-- Como correr setlog
consult('setlog.pl').
setlog.

-- Como cargar la spec
type_check.
consult('reader-writer-lock.slog').
vcg('reader-writer-lock.slog').
consult('reader-writer-lock-vc.slog').
check_vcs_reader-writer-lock.

-- Version 2
type_check.
consult('reader-writer-lock-v2.slog').
vcg('reader-writer-lock-v2.slog').
consult('reader-writer-lock-v2-vc.slog').
check_vcs_reader-writer-lock-v2.


-- TTF SetMaxReaders
ttf(rwlock).
applydnf(setMaxReaders(N)).
applysc(setMaxReaders_vis,Readers).
prunett.
applyii(setMaxReaders_dnf_3,N,[0,2]).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF acquireRead
ttf(rwlock).
applydnf(acquireRead(P)).
applysp(acquireRead_vis,un(Readers, {P}, Readers_)).
prunett.
applyii(acquireRead_dnf_5,MaxReaders,[1,2]).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF acquireWrite
ttf(rwlock).
applydnf(acquireWrite(P)).
applysc(acquireWrite_dnf_1,Readers).
applysc(acquireWrite_dnf_2,Readers).
applysc(acquireWrite_dnf_5,Readers).
prunett.
applyst(acquireWrite_dnf_4,P).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF releaseRead
ttf(rwlock).
applydnf(releaseRead(P)).
applysp(releaseRead_vis,diff(Readers, {P}, Readers_)).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF releaseWrite
ttf(rwlock).
applydnf(releaseWrite(P)).
applyst(releaseWrite_vis,P).
prunett.
applysc(releaseWrite_dnf_2,Readers).
prunett.
gentc.
writett.
writetc.
exporttt.