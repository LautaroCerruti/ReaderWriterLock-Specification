-- Como correr setlog
consult('setlog.pl').
setlog.

-- Como cargar la spec
type_check.
consult('reader-writer-lock.slog').
vcg('reader-writer-lock.slog').
consult('reader-writer-lock-vc.slog').
check_vcs_reader-writer-lock.

-- Version 2
type_check.
consult('reader-writer-lock-v2.slog').
vcg('reader-writer-lock-v2.slog').
consult('reader-writer-lock-v2-vc.slog').
check_vcs_reader-writer-lock-v2.


-- TTF SetMaxReaders
ttf(rwlock).
applydnf(setMaxReaders(N)).
applysc(setMaxReaders_dnf_1,Readers).
prunett.
applyii(setMaxReaders_dnf_2,N,[-2,0]).
prunett.
applyii(setMaxReaders_dnf_3,N,[0,2]).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF acquireRead
ttf(rwlock).
applydnf(acquireRead(P)).
applysp(acquireRead_dnf_1,un(Readers, {P}, Readers_)).
prunett.
applysc(acquireRead_dnf_2,Readers).
prunett.
applysc(acquireRead_dnf_4,Readers).
prunett.
applysc(acquireRead_dnf_5,Readers).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF acquireWrite
ttf(rwlock).
applydnf(acquireWrite(P)).
applysc(acquireWrite_dnf_2,Readers).
prunett.
applysc(acquireWrite_dnf_5,Readers).
prunett.
applyst(acquireWrite_dnf_4,P).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF releaseRead
ttf(rwlock).
applydnf(releaseRead(P)).
applysp(releaseRead_vis,diff(Readers, {P}, Readers_)).
prunett.
applyst(releaseRead_dnf_2,P).
prunett.
gentc.
writett.
writetc.
exporttt.

-- TTF releaseWrite
ttf(rwlock).
applydnf(releaseWrite(P)).
applysc(releaseWrite_dnf_2,Readers).
prunett.
applyst(releaseWrite_dnf_2,P).
prunett.
applyst(releaseWrite_dnf_3,P).
prunett.
gentc.
writett.
writetc.
exporttt.